# What's Knex?

Knex is a query builder that handles database migrations
Credit(https://dev.to/mrscx/a-definitive-guide-to-sql-in-nodejs-with-objection-js-knex-part-1-4c2e)

### Initialize

Run the command below to generate a file named `knexfile.js` which holds the database connection config:

```
knex init
```

Change the config settings to your info:

```
module.exports = {
  development: {
      client: ‘mysql’,
      connection: {
      host: ‘127.0.0.1’,
      user: ‘root’, // replace with your mysql username
      password: ‘123456’, // replace with your mysql password
      database: ‘objection_crud’
    },
    debug: true
  }
};
```

> debug: true - This prints the SQL generated by knex to the console

Once the knexfile is set up, create a file to export the database connection (db_connection.js).

```
// config/db_connection.js
const knex = require("knex");
const knexFile = require("../knexfile");

const env = process.env.NODE_ENV || "development";
const configOptions = knexFile[env];

module.exports = knex(configOptions);
```

## Migrations

Migrations allow us to easily alter a table after they have been created.

To create a migration type (example=roles):

```
knex migrate:make roles
```

This will generate a `migrations` folder in the project directory with a migration file inside.
This file has 2 functions, `up` and `down`.

### Rollback

To rollback the last batch of migrations:

```
knex migrate:rollback
```

To rollback all the completed migrations:

```
knex migrate:rollback --all
```

## Seeding

Seed files allow you to populate your database with test or seed data independent of your migration files.

To generate seeds, run the command below:

```
knex seed:make todo
```

This will create a todo.js file in your seeds directory. Include your test data in the template, example below:

```
exports.seed = function(knex) {
  // Deletes ALL existing entries
  return knex('todo').del()
    .then(function () {
      // Inserts seed entries
      return knex('todo').insert([
        {id: 1, task: 'Create API'},
        {id: 2, task: 'Watch Money Heist'},
        {id: 3, task: 'Do Dishex'}
      ]);
    });
};
}
```

To run the seed file:

```
knex seed:run
```

To make things even easier, you can add a script to `package.json`:

```
"script": {
    "seed": "knex seed:run"
}
```
